<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R</title>
  <meta name="description" content="Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R" />
  <meta name="generator" content="bookdown 0.12 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://github.com/StefanoBertoUTSW/PEB_BOOK" />
  <meta property="og:image" content="https://github.com/StefanoBertoUTSW/PEB_BOOKimages/cover.jpg" />
  <meta property="og:description" content="Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R" />
  
  <meta name="twitter:description" content="Chapter 1 Introduction to RNA-seq pipes | Comparative genomics using R" />
  <meta name="twitter:image" content="https://github.com/StefanoBertoUTSW/PEB_BOOKimages/cover.jpg" />

<meta name="author" content="Stefano Berto, PhD" />


<meta name="date" content="2020-03-01" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html">
<link rel="next" href="DataExploration.html">
<script src="libs/jquery/jquery.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets/htmlwidgets.js"></script>
<link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding/datatables.js"></script>
<link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Comparative Genomics</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introduction</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-will-you-get-out-of-this"><i class="fa fa-check"></i>What will you get out of this?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#structure-of-the-course"><i class="fa fa-check"></i>Structure of the course</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-needed-to-run-the-course-code"><i class="fa fa-check"></i>Packages needed to run the course code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introPipes.html"><a href="introPipes.html"><i class="fa fa-check"></i><b>1</b> Introduction to RNA-seq pipes</a><ul>
<li class="chapter" data-level="1.1" data-path="introPipes.html"><a href="introPipes.html#sequencing-machines"><i class="fa fa-check"></i><b>1.1</b> Sequencing Machines</a></li>
<li class="chapter" data-level="1.2" data-path="introPipes.html"><a href="introPipes.html#fastq"><i class="fa fa-check"></i><b>1.2</b> FASTQ</a></li>
<li class="chapter" data-level="1.3" data-path="introPipes.html"><a href="introPipes.html#quality-check"><i class="fa fa-check"></i><b>1.3</b> Quality Check</a></li>
<li class="chapter" data-level="1.4" data-path="introPipes.html"><a href="introPipes.html#quality-trimming"><i class="fa fa-check"></i><b>1.4</b> Quality Trimming</a></li>
<li class="chapter" data-level="1.5" data-path="introPipes.html"><a href="introPipes.html#alignment"><i class="fa fa-check"></i><b>1.5</b> Alignment</a></li>
<li class="chapter" data-level="1.6" data-path="introPipes.html"><a href="introPipes.html#statistics-and-filtering"><i class="fa fa-check"></i><b>1.6</b> Statistics and Filtering</a></li>
<li class="chapter" data-level="1.7" data-path="introPipes.html"><a href="introPipes.html#lift-over"><i class="fa fa-check"></i><b>1.7</b> Lift over</a></li>
<li class="chapter" data-level="1.8" data-path="introPipes.html"><a href="introPipes.html#quantification"><i class="fa fa-check"></i><b>1.8</b> Quantification</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="DataExploration.html"><a href="DataExploration.html"><i class="fa fa-check"></i><b>2</b> Data Exploration</a><ul>
<li class="chapter" data-level="2.0.1" data-path="DataExploration.html"><a href="DataExploration.html#data-loading"><i class="fa fa-check"></i><b>2.0.1</b> Data loading</a></li>
<li class="chapter" data-level="2.0.2" data-path="DataExploration.html"><a href="DataExploration.html#demographic-screening"><i class="fa fa-check"></i><b>2.0.2</b> Demographic screening</a></li>
<li class="chapter" data-level="2.0.3" data-path="DataExploration.html"><a href="DataExploration.html#data-normalization"><i class="fa fa-check"></i><b>2.0.3</b> Data normalization</a></li>
<li class="chapter" data-level="2.0.4" data-path="DataExploration.html"><a href="DataExploration.html#initial-data-exploration"><i class="fa fa-check"></i><b>2.0.4</b> Initial Data Exploration</a></li>
<li class="chapter" data-level="2.0.5" data-path="DataExploration.html"><a href="DataExploration.html#variance-explained-by-covariates"><i class="fa fa-check"></i><b>2.0.5</b> Variance explained by covariates</a></li>
<li class="chapter" data-level="2.0.6" data-path="DataExploration.html"><a href="DataExploration.html#save-the-data"><i class="fa fa-check"></i><b>2.0.6</b> Save the data</a></li>
<li class="chapter" data-level="2.0.7" data-path="DataExploration.html"><a href="DataExploration.html#exercise-for-data-exploration-chapter"><i class="fa fa-check"></i><b>2.0.7</b> Exercise for Data Exploration chapter</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html"><i class="fa fa-check"></i><b>3</b> Differential Expression Analysis</a><ul>
<li class="chapter" data-level="3.1" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#data-loading-1"><i class="fa fa-check"></i><b>3.1</b> Data loading</a></li>
<li class="chapter" data-level="3.2" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#dge-based-on-linear-model"><i class="fa fa-check"></i><b>3.2</b> DGE based on linear model</a></li>
<li class="chapter" data-level="3.3" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#species-specific-dge"><i class="fa fa-check"></i><b>3.3</b> Species Specific DGE</a></li>
<li class="chapter" data-level="3.4" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#surrogate-variables"><i class="fa fa-check"></i><b>3.4</b> Surrogate Variables</a></li>
<li class="chapter" data-level="3.5" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#balance-the-gene-expression-for-covariates"><i class="fa fa-check"></i><b>3.5</b> Balance the gene expression for covariates</a></li>
<li class="chapter" data-level="3.6" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#dge-visualizations"><i class="fa fa-check"></i><b>3.6</b> DGE visualizations</a></li>
<li class="chapter" data-level="3.7" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#functional-enrichment"><i class="fa fa-check"></i><b>3.7</b> Functional Enrichment</a></li>
<li class="chapter" data-level="3.8" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#dge-based-on-deseq2"><i class="fa fa-check"></i><b>3.8</b> DGE based on DESeq2</a></li>
<li class="chapter" data-level="3.9" data-path="DiffExpAnalysis.html"><a href="DiffExpAnalysis.html#exercise-for-differential-expression-chapter"><i class="fa fa-check"></i><b>3.9</b> Exercise for Differential Expression Chapter</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Comparative genomics using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="introPipes" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction to RNA-seq pipes</h1>
<div id="sequencing-machines" class="section level2">
<h2><span class="header-section-number">1.1</span> Sequencing Machines</h2>
<p>Sequencing machines vary based on number of reads they sequence and running costs. Nowadays, the most used are NovaSeq and NextSeq 500, both illumina.</p>
<p><a href="" target="_blank"><img src="images/seqmachines.jpg" width="500px" style="display: block; margin: auto;" /></a></p>
</div>
<div id="fastq" class="section level2">
<h2><span class="header-section-number">1.2</span> FASTQ</h2>
<p>This is the files sequencing facilities usually provide. This output is the same for multiple data, from RNA-seq to ChIP-seq, ATAC-seq, and so on. The FASTQ file is a modified version of a FASTA file with some additional information.</p>
<p><a href="" target="_blank"><img src="images/fastq_fig.jpg" width="500px" style="display: block; margin: auto;" /></a></p>
</div>
<div id="quality-check" class="section level2">
<h2><span class="header-section-number">1.3</span> Quality Check</h2>
<p>This is a step to understand the quality of the million of reads the FASTQ contains.
It can be done using fastqc (<a href="https://www.bioinformatics.babraham.ac.uk/projects/fastqc/" class="uri">https://www.bioinformatics.babraham.ac.uk/projects/fastqc/</a>) or in R with <code>library(fastqcr)</code> or <code>library(Rqc)</code></p>
<p>Here a simple R example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">BiocManager<span class="op">::</span><span class="kw">install</span>(<span class="st">&quot;Rqc&quot;</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">library</span>(Rqc)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co"># load the fastq.gz files in your specific directory</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4">quality_checks &lt;-<span class="st"> </span><span class="kw">rqc</span>(<span class="dt">path =</span> <span class="st">&quot;path_to_your_directory&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;.fastq.gz&quot;</span>, </a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">openBrowser =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">rqcCycleQualityBoxPlot</span>(quality_checks)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">rqcCycleBaseCallsLinePlot</span>(quality_checks)</a></code></pre></div>
<p>This will output similar plots and data quality check as fastqc.</p>
<p><a href="" target="_blank"><img src="images/fastqc.jpg" width="300px" style="display: block; margin: auto;" /></a></p>
</div>
<div id="quality-trimming" class="section level2">
<h2><span class="header-section-number">1.4</span> Quality Trimming</h2>
<p>After checking the quality you can decide to trim the reads or not.
Quality trimming is necessary to remove potential portion of the reads and/or base pairs with low quality. Low quality bases or fragments can affect mappability to the genome.
Trimming can be done using trimmomatic (<a href="http://www.usadellab.org/cms/?page=trimmomatic" class="uri">http://www.usadellab.org/cms/?page=trimmomatic</a>), fastx (<a href="http://hannonlab.cshl.edu/fastx_toolkit/" class="uri">http://hannonlab.cshl.edu/fastx_toolkit/</a>), or Trim Galore (<a href="https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/" class="uri">https://www.bioinformatics.babraham.ac.uk/projects/trim_galore/</a>).</p>
</div>
<div id="alignment" class="section level2">
<h2><span class="header-section-number">1.5</span> Alignment</h2>
<p>After quality check and trimming, the reads can be aligned to the reference genome. The process map the reads into the genome using a specific set of coordinates for genes. Alignment algorithms tolerate mismatches between reads and genome increasing overall mappability quality. Reads can be multimapped (map to multiple places on the genome) or with overall low quality. Alignment algorithms provide a quality score (MAPQ) for each reads and this can be easily used for filtering bad reads and retain only reads with high quality score which is often linked to uniquely mapped reads.</p>
<p>There are different aligner for different type of NGS data.</p>
<p>Here some example for ChIP-seq/ATAC-seq:</p>
<ul>
<li><p>BWA (<a href="http://bio-bwa.sourceforge.net/" class="uri">http://bio-bwa.sourceforge.net/</a>)</p></li>
<li><p>Bowtie2 (<a href="http://bowtie-bio.sourceforge.net/bowtie2/index.shtml" class="uri">http://bowtie-bio.sourceforge.net/bowtie2/index.shtml</a>)</p></li>
</ul>
<p>For RNA-seq data instead there are splice aware aligners. They require a gene annotation usually stored in a gtf file. GTF can be found in UCSC/Ensembl for different species. For model species such as human and mouse you can also find them in Genecode (<a href="https://www.gencodegenes.org/" class="uri">https://www.gencodegenes.org/</a>). These aligners can splice the reads that belongs to different portions of the genomes (e.g. two different exons separated by an intron):</p>
<ul>
<li><p>STAR (<a href="https://github.com/alexdobin/STAR" class="uri">https://github.com/alexdobin/STAR</a>)</p></li>
<li><p>HISAT (<a href="https://ccb.jhu.edu/software/hisat2/index.shtml" class="uri">https://ccb.jhu.edu/software/hisat2/index.shtml</a>)</p></li>
</ul>
<p>First you will need to create a genome index.
Here an example for STAR:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">STAR <span class="op">--</span>runMode genomeGenerate \</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="op">--</span>genomeDir Human_Genome_Directory<span class="op">/</span><span class="st"> </span>\</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="op">--</span>genomeFastaFiles Human_Genome_Directory<span class="op">/</span><span class="er">*</span>.fa \</a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="op">--</span>runThreadN <span class="dv">13</span> \</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="op">--</span>sjdbGTFfile gene_annotation.gtf \</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="op">--</span>sjdbOverhang <span class="dv">75</span></a></code></pre></div>
<p>Then you can start the alignment</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="cf">for</span> file <span class="cf">in</span> <span class="st">`</span><span class="dt">ls *.Trim.fastq.gz</span><span class="st">`</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">do</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">outputname=<span class="st">`</span><span class="dt">basename $file | sed -e &quot;s/.Trim.fastq.gz//&quot;</span><span class="st">`</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">STAR <span class="op">--</span>runThreadN <span class="dv">14</span> \</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="op">--</span>genomeDir Human_Genome_Directory<span class="op">/</span><span class="st"> </span>\</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="op">--</span>readFilesIn <span class="op">$</span>file \</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="op">--</span>readFilesCommand zcat \</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="op">--</span>sjdbGTFfile Human_Genome_Directory<span class="op">/</span>gene_annotation.gtf \</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="op">--</span>outFilterType BySJout  \</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="op">--</span>outFilterMismatchNoverReadLmax <span class="fl">0.04</span> \</a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="op">--</span>outFilterMultimapNmax <span class="dv">10</span> \</a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="op">--</span>alignSJoverhangMin <span class="dv">10</span> \</a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="op">--</span>alignSJDBoverhangMin <span class="dv">1</span> \</a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="op">--</span>outSAMtype BAM SortedByCoordinate \</a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="op">--</span>outSAMunmapped Within \</a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="op">--</span>outFilterMismatchNmax <span class="dv">3</span> \</a>
<a class="sourceLine" id="cb4-17" data-line-number="17"><span class="op">--</span>twopassMode Basic \</a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="op">--</span>outFileNamePrefix <span class="op">$</span>outputname \</a>
<a class="sourceLine" id="cb4-19" data-line-number="19"><span class="op">--</span>chimSegmentMin <span class="dv">15</span> \</a>
<a class="sourceLine" id="cb4-20" data-line-number="20"><span class="op">--</span>chimScoreMin <span class="dv">15</span> \</a>
<a class="sourceLine" id="cb4-21" data-line-number="21"><span class="op">--</span>chimScoreSeparation <span class="dv">10</span> \</a>
<a class="sourceLine" id="cb4-22" data-line-number="22"><span class="op">--</span>chimJunctionOverhangMin <span class="dv">15</span> \</a>
<a class="sourceLine" id="cb4-23" data-line-number="23"><span class="op">--</span>quantMode TranscriptomeSAM</a>
<a class="sourceLine" id="cb4-24" data-line-number="24">echo <span class="op">$</span>outputname</a>
<a class="sourceLine" id="cb4-25" data-line-number="25">done</a></code></pre></div>
</div>
<div id="statistics-and-filtering" class="section level2">
<h2><span class="header-section-number">1.6</span> Statistics and Filtering</h2>
<p>Alignment will provide a SAM/BAM file that can be easily handle with samtools (<a href="https://github.com/samtools/" class="uri">https://github.com/samtools/</a>). This format contains all the reads and the statistics from the alignment (mapped, unmapped, MAPQ, …) with specific FLAG id. Ideally you want to work with uniquely mapped reads (e.g. reads that mapped into a single region). Some aligners can provide directly a bam file with only uniquely mapped reads. On the other hand, some aligner does not provide a flag for uniquely mapped (NH:i:1). Therefore you need to use MAPQ and filter for a specific threshold. As I descibed above, MAPQ is a -log10(P-value). Therefore, we can apply a threshold for such quality score.</p>
<p>Here an example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">ls <span class="op">*</span>.bam <span class="op">|</span><span class="st"> </span>parallel <span class="op">--</span>progress <span class="op">--</span>eta <span class="op">-</span>j <span class="dv">15</span> <span class="st">&#39;samtools view -bq 10 {} &gt; {.}_mapQ10.bam&#39;</span></a></code></pre></div>
<p>Here the example for fetching uniquely mapped reads (from STAR):</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="cf">for</span> file <span class="cf">in</span> <span class="st">`</span><span class="dt">ls *.ex.bam</span><span class="st">`</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">do</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  outputname=<span class="st">`</span><span class="dt">basename $file | sed -e &quot;s/.bam/.unique.bam/&quot;</span><span class="st">`</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">    (samtools view <span class="op">-</span>H <span class="op">$</span>file; samtools view <span class="op">-</span>F <span class="dv">2308</span> <span class="op">$</span>file <span class="op">|</span><span class="st"> </span>grep <span class="op">-</span>w <span class="st">&#39;NH:i:1&#39;</span>) <span class="op">|</span><span class="st"> </span>\</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">    samtools view <span class="op">-</span>bS <span class="op">-</span><span class="st"> </span><span class="er">&gt;</span><span class="st"> &quot;$outputname&quot;</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">  echo <span class="op">$</span>file</a>
<a class="sourceLine" id="cb6-7" data-line-number="7">  echo <span class="op">$</span>outputname</a>
<a class="sourceLine" id="cb6-8" data-line-number="8">done</a></code></pre></div>
<p>Before and after filtering you can collect alignment statistics on the BAM file. This step can help with data handling and see whether there are biases on the sequencing you are analyzing.
One of the most used tool is picard (<a href="https://broadinstitute.github.io/picard/" class="uri">https://broadinstitute.github.io/picard/</a>). Picard can be wrapped using picardmetrics (<a href="https://github.com/slowkow/picardmetrics" class="uri">https://github.com/slowkow/picardmetrics</a>), a tool that will collect directly multiple statictis.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">find . <span class="op">-</span>name <span class="st">&quot;*.bam&quot;</span> <span class="op">|</span><span class="st"> </span>\</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  xargs <span class="op">-</span>n <span class="dv">1</span> <span class="op">-</span>P <span class="dv">12</span> <span class="op">-</span>iFILES sh <span class="op">-</span>c <span class="st">&#39;picardmetrics run -k -r -o PICARDMETRICS_OUT/ FILES;&#39;</span>; </a></code></pre></div>
</div>
<div id="lift-over" class="section level2">
<h2><span class="header-section-number">1.7</span> Lift over</h2>
<p>When analyzing different species you need a good quality gene annotation for the downstream quantification. Unfortunately, the best annotations are always based on model species as <strong>Human</strong> and <strong>Mouse</strong>.</p>
<p>Therefore, it is necessary to translate coordinates of non-model species into model species for a better annotation. You can use these translated files with the primary annotation for the model species (in this case Human).</p>
<p>There are tools that can help you with that: <strong>liftOver</strong> (<a href="https://genome.ucsc.edu/cgi-bin/hgLiftOver" class="uri">https://genome.ucsc.edu/cgi-bin/hgLiftOver</a>) and <strong>CrossMap</strong> (<a href="http://crossmap.sourceforge.net/" class="uri">http://crossmap.sourceforge.net/</a>)</p>
<p>These methods are based on cross-species annotations that you can easily find at the <strong>UCSC Genome Brower</strong> website (e.g. <a href="https://hgdownload.soe.ucsc.edu/goldenPath/hg38/liftOver/" class="uri">https://hgdownload.soe.ucsc.edu/goldenPath/hg38/liftOver/</a>).</p>
<p>Here an example for CrossMap:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># Lifting a chimpanzee bam to human coordinates</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">python CrossMap.py bam panTro4ToHg38.over.chain.gz Chimp_Input.bam Chimp_Output</a></code></pre></div>
</div>
<div id="quantification" class="section level2">
<h2><span class="header-section-number">1.8</span> Quantification</h2>
<p>BAM files contain reads mapped to the genome with specific genomic coordinates (e.g. chromosome, start, end, strand). These information are used for the quantification per gene counting the reads that overlap with the genomic location of a specific gene. Nevertheless there are some issue the quantifications tool are aware of (e.g. different genes found in overlapping genomic locations but opposite strand). These confounding factors are taken into account during quantifications.</p>
<p>There are several typo of quantification methods.</p>
<p>Alignment free (or pseudoalignment):</p>
<ul>
<li><p>Salmon (<a href="https://salmon.readthedocs.io/en/latest/salmon.html" class="uri">https://salmon.readthedocs.io/en/latest/salmon.html</a>)</p></li>
<li><p>Kallisto (<a href="https://pachterlab.github.io/kallisto/" class="uri">https://pachterlab.github.io/kallisto/</a>)</p></li>
<li><p>Sailfish (<a href="https://www.cs.cmu.edu/~ckingsf/software/sailfish/" class="uri">https://www.cs.cmu.edu/~ckingsf/software/sailfish/</a>)</p></li>
</ul>
<p>Alignment based (they need a GTF and aligned reads):</p>
<ul>
<li><p>HTSeq-Count (<a href="https://htseq.readthedocs.io/en/release_0.11.1/index.html" class="uri">https://htseq.readthedocs.io/en/release_0.11.1/index.html</a>)</p></li>
<li><p>featureCounts (<a href="http://bioinf.wehi.edu.au/featureCounts/" class="uri">http://bioinf.wehi.edu.au/featureCounts/</a>)</p></li>
<li><p>RSEM (<a href="https://github.com/deweylab/RSEM" class="uri">https://github.com/deweylab/RSEM</a>)</p></li>
</ul>
<p>Here one example for HTSeq:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">parallel <span class="op">-</span>j <span class="dv">14</span> <span class="st">&#39;samtools view {} | htseq-count -m intersection-strict \</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2"><span class="st">-t exon \</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">-i gene_name \</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">-s reverse \</span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">- Human_Genome_Directory/gene_annotation.gtf &gt; {.}.txt&#39;</span> <span class="op">:::</span><span class="st"> </span><span class="er">*</span>.unique.bam</a></code></pre></div>
<p>The result of the quantification is a value per each gene per each sample. This is the raw count that determine how much this gene is expressed.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="DataExploration.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/01-introPipes.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["bookdown-demo.pdf", "bookdown-demo.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
